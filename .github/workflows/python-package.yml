# .github/workflows/ci.yml

# Step 5: Run tests with pytest using placeholder DB config
- name: Run tests with pytest (CI environment)
  # We inject placeholder environment variables for CI
  # This ensures config.py checks pass without exposing real secrets
  env:
    # Individual DB credentials (used if config.py checks individual values)
    DB_USER: ci_test_user
    DB_PASS: ci_test_pass
    DB_HOST: 127.0.0.1
    DB_NAME: ci_test_db
    DB_PORT: 5432

    # Full database URLs (satisfy main config checks)
    DATABASE_URL: postgresql://ci_test_user:ci_test_pass@127.0.0.1:5432/ci_test_db
    ASYNC_DATABASE_URL: postgresql+asyncpg://ci_test_user:ci_test_pass@127.0.0.1:5432/ci_test_db

    # Optional: force CI environment in config.py
    ENVIRONMENT: ci
    DEBUG: 'False'
    SECRET_KEY: placeholder_secret

  run: |
    echo "Running CI tests with placeholder DB..."
    pytest -k "not firebase and not db" --disable-warnings --maxfail=5 --tb=short
